# .stagefreight.yml â€” Cross-Platform CLI Tool
#
# Who: Developers shipping a CLI binary for multiple OS/arch combos.
#      Go, Rust, C projects that cross-compile. No container image needed.
# What: Matrix build producing binaries for linux, macOS, and Windows.
#       Packaged as tar.gz (unix) and zip (windows). Attached to git releases.
# Build: Dockerfile defines the toolchain, output is extracted artifacts.
# Why: Replaces a 100-line CI script with a declarative manifest. Devs run
#      `stagefreight build` locally and get the same artifacts CI produces.

version: 1

release:
  notes: true
  badge: true

build:
  artifacts:
    - name: mycli
      dockerfile: build/Dockerfile
      build_args:
        VERSION: "{version}"
      matrix:
        - { goos: linux,   goarch: amd64, suffix: linux-amd64 }
        - { goos: linux,   goarch: arm64, suffix: linux-arm64 }
        - { goos: darwin,  goarch: amd64, suffix: darwin-amd64 }
        - { goos: darwin,  goarch: arm64, suffix: darwin-arm64 }
        - { goos: windows, goarch: amd64, suffix: windows-amd64, ext: .exe }
      extract:
        - from: "/out/mycli{ext}"
          to: "dist/mycli-{suffix}/"
      package:
        - type: tar.gz
          name: "mycli-{version}-{suffix}.tar.gz"
          contents: "dist/mycli-{suffix}/"
          if: "goos != 'windows'"
        - type: zip
          name: "mycli-{version}-{suffix}.zip"
          contents: "dist/mycli-{suffix}/"
          if: "goos == 'windows'"
  release_assets: true

security:
  audit_deps: true

dev:
  test:
    sanity:
      - { name: unit-tests, run: "go test ./... -v -count=1" }
      - { name: lint, run: "golangci-lint run" }
